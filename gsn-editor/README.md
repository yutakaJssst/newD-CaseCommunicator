# GSN Editor

GSN (Goal Structuring Notation) 図を作成・編集するためのWebアプリケーション。

## 🎯 概要

このプロジェクトは、既存のD-Case Communicatorをモダンな技術スタックで再実装したものです。
直感的な操作でGSN図を作成でき、リッチテキスト編集やURLリンクにも対応しています。

## ✨ 主な機能

- **8種類のGSNノード**: Goal, Strategy, Context, Evidence, Assumption, Justification, Undeveloped, Module
- **ノードラベル自動採番**: G1, S1, E1など自動付与、手動編集も可能
- **自動レイアウト機能** ⚡: ワンクリックでツリー構造を整列
  - Reingold-Tilfordアルゴリズムによる階層的配置
  - Context系ノード（Context、Assumption、Justification）は親ノードの右側に横配置
  - 複数のContext系ノードはバランス良く上下に配置
  - 複数のルートノードにも対応
- **モジュール機能**: 複雑な図を階層化して管理
  - Goalを右クリック→「モジュールにする」でサブツリーを別ダイアグラムに分離
  - サイドバーから直接空のModuleノードを配置可能
  - モジュール内のトップGoalの内容が自動的に親ダイアグラムに反映
  - パンくずリストでモジュール間を移動
- **サブツリーのコピー**: ノードを右クリック→「ツリーをコピー」で子孫ノードを一括コピー&ペースト
- **直感的な操作**: ドラッグ&ドロップでノード配置・移動
- **グリッドスナップ**: ヘッダーの⊞ボタンでON/OFF、20px間隔グリッドに吸着
- **リッチテキスト編集**: 太字、斜体、下線、フォントサイズ、URLリンク対応
- **複数選択**: Ctrl+クリックで複数ノードを選択・一括移動
- **GSN標準準拠**: ノードタイプに基づく自動的なリンク接続と矢印スタイル
- **リンク削除**: リンクを右クリックで削除
- **自動保存**: LocalStorageに自動保存（モジュール階層も含む）
- **Undo/Redo**: 操作履歴の管理（Ctrl+Z / Ctrl+Y）
- **エクスポート**: JSON/PNG/SVG形式、プロジェクト全体のエクスポートも可能

## 🚀 クイックスタート

### 必要要件
- Node.js 18+
- npm

### インストール

```bash
npm install
```

### 開発サーバーの起動

```bash
npm run dev
```

ブラウザで `http://localhost:5173/` を開く

### ビルド

```bash
npm run build
```

## 📖 使い方

### ノードの追加

1. 左サイドバーからノードタイプを選択
2. キャンバスをクリックしてノードを配置

### ノードの編集

- **移動**: ノードをドラッグ、または矢印キーで微調整（1px単位、Shift押下で10px）
- **編集**: ノードをダブルクリック
- **サイズ変更**: ノードを選択して、4隅のハンドルをドラッグ
- **削除**: ノードを右クリック → 「削除」、またはDeleteキー/Backspaceキー

### リンクの追加・削除

**追加:**
1. ノードを右クリック → 「子ノードにリンク」
2. 親ノード（現在のノード）がハイライト表示
3. 子ノードをクリック

**削除:**
- リンクを右クリック → 「リンクを削除」

### モジュール機能

**既存のGoalからモジュール化:**
1. Goalノードを右クリック → 「モジュールにする」
2. そのGoal以下のサブツリーが別ダイアグラムになる
3. 元の位置にModuleノードが配置される

**空のモジュール作成:**
1. サイドバーから「モジュール」を選択
2. キャンバスをクリックして配置
3. Moduleノードをダブルクリックして内部を開く
4. モジュール内でGSN図を作成

**モジュール間の移動:**
- Moduleノードをダブルクリック → モジュール内を開く
- ヘッダーのパンくずリストをクリック → 親ダイアグラムに戻る
- モジュール内で編集した内容は自動保存され、親に戻ると反映される

### 複数選択

- **Ctrl+クリック**: 複数ノードを選択
- **ドラッグ**: 選択したノードを一括移動

### サブツリーのコピー

**ノードとその子孫を一括コピー:**
1. ノードを右クリック → 「ツリーをコピー」
2. そのノード以下の全サブツリー（子孫ノードとリンク）がクリップボードにコピーされる
3. **Ctrl+V** (Cmd+V) でペースト
4. 新しいIDとラベルが自動割り当てされ、50pxずらして配置される

### キャンバス操作

- **パン**: 空白領域をドラッグ / Shift+ドラッグ / 中ボタンドラッグ
- **ズーム**: マウスホイール（Ctrl+ホイール）/ ヘッダーの +/- ボタン
- **全体表示**: ヘッダーの **⊡** ボタンをクリック（全ノードが画面内に収まるよう自動調整）
- **ズームリセット**: 表示倍率（例: 100%）をクリックで100%にリセット

### リッチテキスト編集

ノード編集モーダルで以下の書式が使用可能：

- **B**: 太字
- **I**: 斜体
- **U**: 下線
- **フォントサイズ**: 小/中/大/特大
- **🔗**: URLリンク（テキスト選択 → リンクボタン → URL入力）

### データの保存・読み込み

- **自動保存**: 編集内容は自動的にLocalStorageに保存
- **エクスポート**: ヘッダー → 「エクスポート ▾」
  - **JSON**: データ形式（version, title, nodes, links, metadata）
  - **PNG画像**: 高解像度2倍、全ノードを含む境界を自動計算
  - **SVG画像**: ベクター形式、拡大縮小しても綺麗
- **インポート**: ヘッダー → 「インポート」→ JSONファイルを選択

### グリッドスナップ

- ヘッダーの **⊞** ボタンをクリックでON/OFF切り替え
- ONの時、20px間隔のグリッド線が表示される
- ノード追加・移動時に自動的にグリッドに吸着

### 自動レイアウト

- ヘッダーの **⚡整列** ボタンをクリック
- ツリー構造が階層的に自動整列される
- **主要ノード**（Goal、Strategy、Evidence等）: 縦に階層配置
- **Context系ノード**（Context、Assumption、Justification）: 親ノードの右側に横配置
- 複数のContext系ノードがある場合は上下にバランス良く配置
- Undo/Redo対応（Ctrl+Zで元に戻せる）

## 📊 GSNノードタイプ

| ノード | 説明 | 形状 | 接続 |
|--------|------|------|------|
| **Goal** | 達成すべき目標 | 矩形 | 下に接続 |
| **Strategy** | ゴール分解の方針 | 平行四辺形 | 下に接続 |
| **Context** | 前提条件 | 角丸矩形 | 横に接続 |
| **Evidence** | ゴール達成の根拠 | 楕円 | 下に接続 |
| **Assumption** | 論証の仮定事項 | 楕円 (A) | 横に接続 |
| **Justification** | 戦略の正当性根拠 | 楕円 (J) | 横に接続 |
| **Undeveloped** | 未展開のゴール | ダイヤモンド | 下に接続 |
| **Module** | 別ダイアグラムへのリンク | フォルダ型 | 下に接続 |

## ⌨️ キーボードショートカット

| ショートカット | 機能 |
|----------------|------|
| **Ctrl+Z** | 元に戻す (Undo) |
| **Ctrl+Y** | やり直す (Redo) |
| **Ctrl+A** | 全ノード選択 (Mac: Cmd+A) |
| **Ctrl+C** | 選択ノードをコピー (Mac: Cmd+C) |
| **Ctrl+V** | コピーしたノードをペースト (Mac: Cmd+V) |
| **Delete / Backspace** | 選択中のノードを削除 |
| **矢印キー** | 選択ノードを1pxずつ移動 |
| **Shift+矢印キー** | 選択ノードを10pxずつ移動 |
| **Ctrl+クリック** | 複数選択 |
| **Shift+ドラッグ** | パン操作 |
| **ESC** | リンク追加モードをキャンセル |

## 🔐 マルチユーザー機能（進行中）

**Phase 1: 認証機能 ✅ 完了**

- **ユーザー登録・ログイン**: JWT認証によるセキュアなユーザー管理
- **自動ログイン**: ブラウザを閉じても認証状態を維持（LocalStorage永続化）
- **ログアウト**: プロジェクト一覧画面とGSNエディタヘッダーにログアウトボタン

**Phase 2: プロジェクト管理 ✅ 完了**

- **プロジェクト一覧画面**: ログイン後、ユーザーのプロジェクト一覧を表示
- **プロジェクト作成**: 新規プロジェクトの作成（タイトル、説明）
- **プロジェクト選択**: プロジェクトカードをクリックしてGSNエディタを開く
- **プロジェクト削除**: オーナーのみ削除可能（確認ダイアログ付き）
- **プロジェクト間移動**: ヘッダーの「←プロジェクト一覧」ボタンで一覧に戻る
- **プロジェクトごとのデータ分離**: LocalStorageにプロジェクトIDごとに独立してGSNデータを保存
- **権限管理**: オーナーと招待されたメンバーのみアクセス可能（基盤実装済み）

**動作確認:**
1. アプリを開くとログイン/登録画面が表示されます
2. 新規登録でアカウント作成（メールアドレス、パスワード必須、名前任意）
3. 登録完了後、自動的にログインしてプロジェクト一覧画面に遷移
4. 「＋ 新規プロジェクト」ボタンでプロジェクトを作成
5. プロジェクトカードをクリックしてGSNエディタを開く
6. ヘッダー右側にユーザー名とログアウトボタンが表示
7. 「←プロジェクト一覧」ボタンでプロジェクト一覧に戻る

**今後の実装予定:**
- **Phase 3**: ダイアグラムのDB保存（現在はLocalStorageのみ）
- **Phase 4**: マルチユーザー共有（プロジェクトメンバーの招待UI、ロール管理）
- **Phase 5**: リアルタイム同時編集（WebSocketによる複数ユーザーの同時編集）

## 🏗️ 技術スタック

### フロントエンド
- **React 19.2.0** - UIフレームワーク
- **TypeScript 5.9.3** - 型安全性
- **Zustand 5.0.9** - 状態管理
- **Vite 7.2.4** - ビルドツール
- **SVG** - ネイティブ描画
- **axios** - HTTPクライアント（API通信）

### バックエンド（新規追加）
- **Node.js + Express** - APIサーバー
- **TypeScript** - 型安全性
- **Prisma ORM** - データベースアクセス
- **SQLite** - データベース（開発環境）
- **JWT + bcrypt** - 認証・セキュリティ
- **Socket.IO** - リアルタイム通信（準備済み）
